Index: app/src/main/java/com/example/thiennguyen/view/bangtin/BangTinFragment.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.thiennguyen.view.bangtin;\r\n\r\nimport android.app.Activity;\r\nimport android.app.AlertDialog;\r\nimport android.content.ContentResolver;\r\nimport android.content.Intent;\r\nimport android.database.Cursor;\r\nimport android.net.Uri;\r\nimport android.os.Bundle;\r\nimport android.provider.MediaStore;\r\nimport android.provider.OpenableColumns;\r\nimport android.util.Log;\r\nimport android.view.LayoutInflater;\r\nimport android.view.MenuItem;\r\nimport android.view.View;\r\nimport android.view.ViewGroup;\r\nimport android.webkit.MimeTypeMap;\r\nimport android.widget.EditText;\r\nimport android.widget.ImageView;\r\nimport android.widget.PopupMenu;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.annotation.Nullable;\r\nimport androidx.fragment.app.Fragment;\r\nimport androidx.recyclerview.widget.LinearLayoutManager;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport com.example.thiennguyen.R;\r\nimport com.example.thiennguyen.api.bangtin.BaiViet;\r\nimport com.example.thiennguyen.api.bangtin.CreatePostRequest;\r\nimport com.example.thiennguyen.api.bangtin.CreatePostResponse;\r\nimport com.example.thiennguyen.api.bangtin.LikeCommentResponse;\r\nimport com.example.thiennguyen.api.bangtin.NewsPost;\r\nimport com.example.thiennguyen.api.bangtin.NewsPostAdapter;\r\nimport com.example.thiennguyen.api.bangtin.RetrofitClient;\r\n\r\nimport com.google.android.material.tabs.TabLayout;\r\n\r\nimport java.io.ByteArrayOutputStream;\r\nimport java.io.IOException;\r\nimport java.io.InputStream;\r\nimport java.text.SimpleDateFormat;\r\nimport java.util.ArrayList;\r\nimport java.util.Date;\r\nimport java.util.List;\r\nimport java.util.Locale;\r\n\r\nimport okhttp3.MediaType;\r\nimport okhttp3.MultipartBody;\r\nimport okhttp3.RequestBody;\r\nimport retrofit2.Call;\r\nimport retrofit2.Callback;\r\nimport retrofit2.Response;\r\n\r\npublic class BangTinFragment extends Fragment {\r\n\r\n    private static final int PICK_IMAGE_REQUEST = 101;\r\n    private static final int COMMENT_REQUEST_CODE = 100;\r\n    private RecyclerView recyclerView;\r\n    private NewsPostAdapter adapter;\r\n    private ArrayList<NewsPost> postList;\r\n    private Uri selectedImageUri;\r\n    private ImageView dialogImgSelectedPhoto;\r\n    private ImageView dialogBtnRemovePhoto;\r\n\r\n    private static final String IMAGE_BASE_URL = \"http://192.168.1.81:5089\";\r\n\r\n\r\n    @Override\r\n    public void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {\r\n        super.onActivityResult(requestCode, resultCode, data);\r\n\r\n        if (resultCode != Activity.RESULT_OK || data == null) {\r\n            return;\r\n        }\r\n\r\n        if (requestCode == COMMENT_REQUEST_CODE) { \r\n            int position = data.getIntExtra(\"post_position\", -1);\r\n            if (position != -1 && position < postList.size()) {\r\n                postList.get(position).commentCount++;\r\n                adapter.notifyItemChanged(position, \"comment_count_changed\");\r\n            }\r\n        } else if (requestCode == PICK_IMAGE_REQUEST) { \r\n            selectedImageUri = data.getData();\r\n            if (dialogImgSelectedPhoto != null && dialogBtnRemovePhoto != null && selectedImageUri != null) {\r\n                dialogImgSelectedPhoto.setImageURI(selectedImageUri);\r\n                dialogImgSelectedPhoto.setVisibility(View.VISIBLE);\r\n                dialogBtnRemovePhoto.setVisibility(View.VISIBLE);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    @Override\r\n    public View onCreateView(LayoutInflater inflater, ViewGroup container, Bundle savedInstanceState) {\r\n        View view = inflater.inflate(R.layout.fragment_bang_tin, container, false);\r\n\r\n        recyclerView = view.findViewById(R.id.bangtin_recyclerViewNews);\r\n        recyclerView.setLayoutManager(new LinearLayoutManager(getContext()));\r\n\r\n        postList = new ArrayList<>();\r\n        adapter = new NewsPostAdapter(postList);\r\n        recyclerView.setAdapter(adapter);\r\n\r\n        adapter.setOnItemClickListener(new NewsPostAdapter.OnItemClickListener() {\r\n            @Override\r\n            public void onCommentClick(int position) {\r\n                handleCommentClick(position);\r\n            }\r\n\r\n            @Override\r\n            public void onLikeClick(int position) {\r\n                handleLikeClick(position);\r\n            }\r\n\r\n            @Override\r\n            public void onMoreOptionsClick(int position, View anchorView) {\r\n                showPostOptionsMenu(position, anchorView);\r\n            }\r\n        });\r\n\r\n        // --- THAY ĐỔI ĐỂ BÁO CÁO ---\r\n        // Vô hiệu hóa việc gọi API thật\r\n        // loadPostsFromServer();\r\n        // Hiển thị dữ liệu giả ngay lập tức\r\n        loadDummyPosts();\r\n        // --------------------------\r\n\r\n        ImageView fabCreatePost = view.findViewById(R.id.bangtin_fab_create_post);\r\n        fabCreatePost.setOnClickListener(v -> showCreatePostDialog());\r\n\r\n        ImageView btnNotification = view.findViewById(R.id.bangtin_btn_notification);\r\n        btnNotification.setOnClickListener(v -> {\r\n            Intent intent = new Intent(getActivity(), ThongBaoActivity.class);\r\n            startActivity(intent);\r\n        });\r\n\r\n        TabLayout tabLayout = view.findViewById(R.id.bangtin_tabLayout);\r\n        tabLayout.addOnTabSelectedListener(new TabLayout.OnTabSelectedListener() {\r\n            @Override public void onTabSelected(TabLayout.Tab tab) {}\r\n            @Override public void onTabUnselected(TabLayout.Tab tab) {}\r\n            @Override public void onTabReselected(TabLayout.Tab tab) {}\r\n        });\r\n\r\n        return view;\r\n    }\r\n\r\n    private void loadPostsFromServer() {\r\n        if (RetrofitClient.getService() == null) {\r\n            Toast.makeText(getContext(), \"Không khởi tạo được API\", Toast.LENGTH_LONG).show();\r\n            return;\r\n        }\r\n\r\n        RetrofitClient.getService().getBaiViets().enqueue(new Callback<List<BaiViet>>() {\r\n            @Override\r\n            public void onResponse(Call<List<BaiViet>> call, Response<List<BaiViet>> response) {\r\n                if (!isAdded()) return;\r\n\r\n                if (response.isSuccessful() && response.body() != null) {\r\n                    postList.clear();\r\n                    for (BaiViet bv : response.body()) {\r\n                        String thoiGian = bv.ngayDang != null ? bv.ngayDang : \"Vừa xong\";\r\n                        String noiDung = bv.noiDung != null ? bv.noiDung : \"\";\r\n                        String imageUrl = null;\r\n                        if (bv.hinhAnh != null && !bv.hinhAnh.isEmpty()) {\r\n                            imageUrl = IMAGE_BASE_URL + bv.hinhAnh;\r\n                        }\r\n                        \r\n                        NewsPost post = new NewsPost(\r\n                                bv.id,\r\n                                \"Người dùng \" + bv.idNguoiDang,\r\n                                thoiGian,\r\n                                noiDung,\r\n                                imageUrl,\r\n                                R.drawable.bangtin_avatar_default,\r\n                                bv.soLuotThich,\r\n                                bv.soLuotBinhLuan\r\n                        );\r\n                        postList.add(0, post);\r\n                    }\r\n                    adapter.notifyDataSetChanged();\r\n                } else {\r\n                    Toast.makeText(getContext(), \"Lỗi server: \" + response.code(), Toast.LENGTH_LONG).show();\r\n                }\r\n            }\r\n\r\n            @Override\r\n            public void onFailure(Call<List<BaiViet>> call, Throwable t) {\r\n                if (!isAdded()) return;\r\n                Toast.makeText(getContext(), \"API không chạy. Hiển thị giao diện xem trước.\", Toast.LENGTH_LONG).show();\r\n                loadDummyPosts();\r\n            }\r\n        });\r\n    }\r\n\r\n    private void loadDummyPosts() {\r\n        if (getContext() == null) return; \r\n\r\n        postList.clear();\r\n\r\n        String dongBaoMtUri = \"android.resource://\" + getContext().getPackageName() + \"/\" + R.drawable.dong_bao_mt;\r\n        String quyenGopKhanCapUri = \"android.resource://\" + getContext().getPackageName() + \"/\" + R.drawable.quyen_gop_khan_cap;\r\n        String tinhNguyenVienUri = \"android.resource://\" + getContext().getPackageName() + \"/\" + R.drawable.tinh_nguyen_vien_trao_qua;\r\n\r\n        postList.add(new NewsPost(\r\n                999,\r\n                \"Quỹ Tấm Lòng Vàng\",\r\n                \"Vừa xong\",\r\n                \"Chung tay ủng hộ đồng bào miền Trung vượt qua bão lũ. Mỗi đóng góp của bạn đều là niềm hy vọng cho những gia đình đang gặp khó khăn.\",\r\n                dongBaoMtUri,\r\n                R.drawable.quy_tamlongvang_avatar,\r\n                1502,\r\n                356\r\n        ));\r\n        postList.add(new NewsPost(\r\n                998,\r\n                \"Hội Chữ Thập Đỏ\",\r\n                \"1 giờ trước\",\r\n                \"Kêu gọi quyên góp khẩn cấp cho các tỉnh bị ảnh hưởng bởi lũ lụt. Hiện chúng tôi đang cần quần áo, lương thực và nước uống sạch. Xin hãy cùng lan tỏa!\",\r\n                quyenGopKhanCapUri, \r\n                R.drawable.hoi_chuthapdo_avatar,\r\n                875,\r\n                128\r\n        ));\r\n         postList.add(new NewsPost(\r\n                997,\r\n                \"Tình nguyện viên An\",\r\n                \"Hôm qua\",\r\n                \"Hôm nay đoàn chúng mình đã trao tận tay 100 phần quà cho các hộ dân tại xã X, huyện Y. Cảm ơn sự đóng góp của tất cả mọi người!\",\r\n                tinhNguyenVienUri,\r\n                R.drawable.tinh_nguyen_vien_an_avatar,\r\n                420,\r\n                95\r\n        ));\r\n        adapter.notifyDataSetChanged();\r\n    }\r\n\r\n    private void handleLikeClick(int position) {\r\n        if (position < 0 || position >= postList.size()) return;\r\n\r\n        NewsPost post = postList.get(position);\r\n\r\n        if (post.id >= 990) { \r\n             post.isLiked = !post.isLiked;\r\n             if(post.isLiked) post.likeCount++; else post.likeCount--;\r\n             adapter.notifyItemChanged(position, \"like_status_changed\");\r\n             return;\r\n        }\r\n        \r\n        post.isLiked = !post.isLiked;\r\n        if(post.isLiked) {\r\n            post.likeCount++;\r\n        } else {\r\n            post.likeCount--;\r\n        }\r\n        adapter.notifyItemChanged(position, \"like_status_changed\");\r\n\r\n        RetrofitClient.getService().likePost(post.id).enqueue(new Callback<LikeCommentResponse>() {\r\n            @Override\r\n            public void onResponse(Call<LikeCommentResponse> call, Response<LikeCommentResponse> response) {\r\n                if (!response.isSuccessful()) {\r\n                    post.isLiked = !post.isLiked;\r\n                    if(post.isLiked) {\r\n                        post.likeCount++;\r\n                    } else {\r\n                        post.likeCount--;\r\n                    }\r\n                    adapter.notifyItemChanged(position, \"like_status_changed\");\r\n                    Toast.makeText(getContext(), \"Lỗi khi thích bài viết\", Toast.LENGTH_SHORT).show();\r\n                }\r\n            }\r\n\r\n            @Override\r\n            public void onFailure(Call<LikeCommentResponse> call, Throwable t) {\r\n                post.isLiked = !post.isLiked;\r\n                if(post.isLiked) {\r\n                    post.likeCount++;\r\n                } else {\r\n                    post.likeCount--;\r\n                }\r\n                adapter.notifyItemChanged(position, \"like_status_changed\");\r\n                Toast.makeText(getContext(), \"Lỗi mạng, không thể thích\", Toast.LENGTH_SHORT).show();\r\n            }\r\n        });\r\n    }\r\n\r\n    private void handleCommentClick(int position) {\r\n        if (position < 0 || position >= postList.size()) return;\r\n\r\n        Intent intent = new Intent(getActivity(), BangTinCommentActivity.class);\r\n        intent.putExtra(\"post_position\", position);\r\n        intent.putExtra(\"post_data\", postList.get(position));\r\n        startActivityForResult(intent, COMMENT_REQUEST_CODE);\r\n    }\r\n\r\n    private void showCreatePostDialog() {\r\n        AlertDialog.Builder builder = new AlertDialog.Builder(requireContext());\r\n        View dialogView = getLayoutInflater().inflate(R.layout.dialog_create_post, null);\r\n        EditText edt = dialogView.findViewById(R.id.edt_create_post_content);\r\n        ImageView btnAddPhoto = dialogView.findViewById(R.id.btn_add_photo);\r\n        dialogImgSelectedPhoto = dialogView.findViewById(R.id.img_selected_photo);\r\n        dialogBtnRemovePhoto = dialogView.findViewById(R.id.btn_remove_photo);\r\n\r\n        selectedImageUri = null;\r\n        dialogImgSelectedPhoto.setImageURI(null);\r\n        dialogImgSelectedPhoto.setVisibility(View.GONE);\r\n        dialogBtnRemovePhoto.setVisibility(View.GONE);\r\n\r\n        btnAddPhoto.setOnClickListener(v -> {\r\n            Intent intent = new Intent(Intent.ACTION_PICK, MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\r\n            startActivityForResult(intent, PICK_IMAGE_REQUEST);\r\n        });\r\n\r\n        dialogBtnRemovePhoto.setOnClickListener(v -> {\r\n            selectedImageUri = null;\r\n            dialogImgSelectedPhoto.setImageURI(null);\r\n            dialogImgSelectedPhoto.setVisibility(View.GONE);\r\n            dialogBtnRemovePhoto.setVisibility(View.GONE);\r\n        });\r\n\r\n        builder.setView(dialogView)\r\n                .setTitle(\"Chia sẻ điều gì đó...\")\r\n                .setPositiveButton(\"Đăng\", (d, w) -> {\r\n                    String content = edt.getText().toString().trim();\r\n                    if (!content.isEmpty() || selectedImageUri != null) {\r\n                        createPostOnServer(1, content, selectedImageUri);\r\n                    } else {\r\n                        Toast.makeText(getContext(), \"Nhập nội dung hoặc chọn ảnh đi nào!\", Toast.LENGTH_SHORT).show();\r\n                    }\r\n                })\r\n                .setNegativeButton(\"Hủy\", null)\r\n                .show();\r\n    }\r\n\r\n    private void createPostOnServer(int idNguoiDang, String noiDung, @Nullable Uri imageUri) {\r\n        Call<CreatePostResponse> call;\r\n\r\n        if (imageUri == null) {\r\n            CreatePostRequest request = new CreatePostRequest(idNguoiDang, noiDung);\r\n            call = RetrofitClient.getService().createBaiViet(request);\r\n        } else {\r\n            if (getContext() == null) return;\r\n\r\n            RequestBody idNguoiDangPart = RequestBody.create(MediaType.parse(\"text/plain\"), String.valueOf(idNguoiDang));\r\n            RequestBody noiDungPart = RequestBody.create(MediaType.parse(\"text/plain\"), noiDung);\r\n            MultipartBody.Part filePart = null;\r\n\r\n            try {\r\n                InputStream inputStream = getContext().getContentResolver().openInputStream(imageUri);\r\n                if (inputStream != null) {\r\n                    byte[] fileBytes = getBytes(inputStream);\r\n                    String mimeType = getMimeType(imageUri);\r\n                    String fileName = getFileName(imageUri);\r\n\r\n                    if (mimeType != null && fileName != null) {\r\n                        RequestBody fileBody = RequestBody.create(MediaType.parse(mimeType), fileBytes);\r\n                        filePart = MultipartBody.Part.createFormData(\"File\", fileName, fileBody);\r\n                    } else {\r\n                        Toast.makeText(getContext(), \"Không thể lấy thông tin tệp tin.\", Toast.LENGTH_SHORT).show();\r\n                        return;\r\n                    }\r\n                } else {\r\n                    Toast.makeText(getContext(), \"Không thể mở tệp hình ảnh.\", Toast.LENGTH_SHORT).show();\r\n                    return;\r\n                }\r\n            } catch (IOException e) {\r\n                e.printStackTrace();\r\n                Toast.makeText(getContext(), \"Lỗi khi đọc tệp hình ảnh.\", Toast.LENGTH_SHORT).show();\r\n                return;\r\n            }\r\n            call = RetrofitClient.getService().createBaiViet(idNguoiDangPart, noiDungPart, filePart);\r\n        }\r\n\r\n        call.enqueue(new Callback<CreatePostResponse>() {\r\n            @Override\r\n            public void onResponse(Call<CreatePostResponse> call, Response<CreatePostResponse> response) {\r\n                if (response.isSuccessful() && response.body() != null) {\r\n                    Toast.makeText(getContext(), \"Đăng thành công!\", Toast.LENGTH_SHORT).show();\r\n                    addNewPostToView(response.body(), noiDung, idNguoiDang);\r\n                } else {\r\n                    Toast.makeText(getContext(), \"Đăng bài thất bại, mã lỗi: \" + response.code(), Toast.LENGTH_SHORT).show();\r\n                }\r\n            }\r\n\r\n            @Override\r\n            public void onFailure(Call<CreatePostResponse> call, Throwable t) {\r\n                Toast.makeText(getContext(), \"Lỗi: \" + t.getMessage(), Toast.LENGTH_LONG).show();\r\n            }\r\n        });\r\n    }\r\n\r\n    private void addNewPostToView(CreatePostResponse postResponse, String noiDung, int idNguoiDang) {\r\n        String imageUrl = null;\r\n        if (postResponse.hinhAnh != null && !postResponse.hinhAnh.isEmpty()) {\r\n            imageUrl = IMAGE_BASE_URL + postResponse.hinhAnh;\r\n        }\r\n\r\n        String currentTime = new SimpleDateFormat(\"dd/MM/yyyy HH:mm\", Locale.getDefault()).format(new Date());\r\n\r\n        NewsPost newPost = new NewsPost(\r\n                postResponse.id,\r\n                \"Người dùng \" + idNguoiDang,\r\n                currentTime,\r\n                noiDung,\r\n                imageUrl,\r\n                R.drawable.bangtin_avatar_default,\r\n                0, \r\n                0\r\n        );\r\n\r\n        postList.add(0, newPost);\r\n        adapter.notifyItemInserted(0);\r\n        recyclerView.scrollToPosition(0); \r\n    }\r\n\r\n\r\n    private void showPostOptionsMenu(final int position, View anchorView) {\r\n        PopupMenu popup = new PopupMenu(getContext(), anchorView);\r\n        popup.getMenuInflater().inflate(R.menu.post_options_menu, popup.getMenu());\r\n\r\n        popup.setOnMenuItemClickListener(item -> {\r\n            if (item.getItemId() == R.id.action_delete_post) {\r\n                 if (postList.get(position).id >= 990) { \r\n                    Toast.makeText(getContext(), \"Không thể xóa bài viết xem trước.\", Toast.LENGTH_SHORT).show();\r\n                    return true;\r\n                 }\r\n                new AlertDialog.Builder(getContext())\r\n                        .setTitle(\"Xác nhận xóa\")\r\n                        .setMessage(\"Bạn có chắc chắn muốn xóa bài viết này?\")\r\n                        .setPositiveButton(\"Xóa\", (dialog, which) -> deletePost(position))\r\n                        .setNegativeButton(\"Hủy\", null)\r\n                        .show();\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n        popup.show();\r\n    }\r\n\r\n    private void deletePost(final int position) {\r\n        if (position < 0 || position >= postList.size()) return;\r\n\r\n        NewsPost postToDelete = postList.get(position);\r\n        int postId = postToDelete.id;\r\n\r\n        Call<Void> call = RetrofitClient.getService().deleteBaiViet(postId);\r\n        call.enqueue(new Callback<Void>() {\r\n            @Override\r\n            public void onResponse(Call<Void> call, Response<Void> response) {\r\n                if (!isAdded()) return;\r\n\r\n                if (response.isSuccessful()) {\r\n                    requireActivity().runOnUiThread(() -> {\r\n                        Toast.makeText(getContext(), \"Đã xóa bài viết\", Toast.LENGTH_SHORT).show();\r\n                        postList.remove(position);\r\n                        adapter.notifyItemRemoved(position);\r\n                        adapter.notifyItemRangeChanged(position, postList.size());\r\n                    });\r\n                } else {\r\n                    String errorDetails = \"Lỗi \" + response.code() + \": \" + response.message() + \"\\nURL: \" + call.request().url();\r\n                    Toast.makeText(getContext(), errorDetails, Toast.LENGTH_LONG).show();\r\n                }\r\n            }\r\n\r\n            @Override\r\n            public void onFailure(Call<Void> call, Throwable t) {\r\n                if (!isAdded()) return;\r\n                Toast.makeText(getContext(), \"Lỗi mạng: \" + t.getMessage(), Toast.LENGTH_LONG).show();\r\n            }\r\n        });\r\n    }\r\n\r\n    private byte[] getBytes(InputStream inputStream) throws IOException {\r\n        ByteArrayOutputStream byteBuffer = new ByteArrayOutputStream();\r\n        int bufferSize = 1024;\r\n        byte[] buffer = new byte[bufferSize];\r\n        int len;\r\n        while ((len = inputStream.read(buffer)) != -1) {\r\n            byteBuffer.write(buffer, 0, len);\r\n        }\r\n        return byteBuffer.toByteArray();\r\n    }\r\n\r\n    private String getFileName(Uri uri) {\r\n        if (getContext() == null) return null;\r\n        String result = null;\r\n        if (uri.getScheme().equals(\"content\")) {\r\n            try (Cursor cursor = getContext().getContentResolver().query(uri, null, null, null, null)) {\r\n                if (cursor != null && cursor.moveToFirst()) {\r\n                    int nameIndex = cursor.getColumnIndex(OpenableColumns.DISPLAY_NAME);\r\n                    if (nameIndex != -1) {\r\n                        result = cursor.getString(nameIndex);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        if (result == null) {\r\n            result = uri.getPath();\r\n            int cut = result.lastIndexOf('/');\r\n            if (cut != -1) {\r\n                result = result.substring(cut + 1);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private String getMimeType(Uri uri) {\r\n        if (getContext() == null) return null;\r\n        String mimeType;\r\n        if (ContentResolver.SCHEME_CONTENT.equals(uri.getScheme())) {\r\n            ContentResolver cr = getContext().getContentResolver();\r\n            mimeType = cr.getType(uri);\r\n        } else {\r\n            String fileExtension = MimeTypeMap.getFileExtensionFromUrl(uri.toString());\r\n            mimeType = MimeTypeMap.getSingleton().getMimeTypeFromExtension(fileExtension.toLowerCase());\r\n        }\r\n        return mimeType;\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/thiennguyen/view/bangtin/BangTinFragment.java b/app/src/main/java/com/example/thiennguyen/view/bangtin/BangTinFragment.java
--- a/app/src/main/java/com/example/thiennguyen/view/bangtin/BangTinFragment.java	(revision 33d3b47e928e075d4e536a8d4cd53365d1637416)
+++ b/app/src/main/java/com/example/thiennguyen/view/bangtin/BangTinFragment.java	(date 1764922830922)
@@ -63,7 +63,7 @@
     private ImageView dialogImgSelectedPhoto;
     private ImageView dialogBtnRemovePhoto;
 
-    private static final String IMAGE_BASE_URL = "http://192.168.1.81:5089";
+    private static final String IMAGE_BASE_URL = "http://192.168.114.213:5089";
 
 
     @Override
Index: app/src/main/java/com/example/thiennguyen/api/bangtin/NewsPostAdapter.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.thiennguyen.api.bangtin;\r\n\r\nimport android.view.LayoutInflater;\r\nimport android.view.View;\r\nimport android.view.ViewGroup;\r\nimport android.widget.ImageView;\r\nimport android.widget.LinearLayout;\r\nimport android.widget.TextView;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.recyclerview.widget.RecyclerView;\r\n\r\nimport com.bumptech.glide.Glide; // THÊM IMPORT GLIDE\r\nimport com.example.thiennguyen.R;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\npublic class NewsPostAdapter extends RecyclerView.Adapter<NewsPostAdapter.NewsPostViewHolder> {\r\n\r\n    private final ArrayList<NewsPost> postList;\r\n    private OnItemClickListener listener;\r\n\r\n    public interface OnItemClickListener {\r\n        void onCommentClick(int position);\r\n        void onLikeClick(int position);\r\n        void onMoreOptionsClick(int position, View view);\r\n    }\r\n\r\n    public void setOnItemClickListener(OnItemClickListener listener) {\r\n        this.listener = listener;\r\n    }\r\n\r\n    public NewsPostAdapter(ArrayList<NewsPost> postList) {\r\n        this.postList = postList;\r\n    }\r\n\r\n    @NonNull\r\n    @Override\r\n    public NewsPostViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\r\n        View view = LayoutInflater.from(parent.getContext()).inflate(R.layout.item_news_post, parent, false);\r\n        return new NewsPostViewHolder(view, listener);\r\n    }\r\n\r\n    @Override\r\n    public void onBindViewHolder(@NonNull NewsPostViewHolder holder, int position) {\r\n        NewsPost currentPost = postList.get(position);\r\n        holder.bind(currentPost);\r\n    }\r\n\r\n    // Tối ưu hóa việc cập nhật chỉ phần thay đổi\r\n    @Override\r\n    public void onBindViewHolder(@NonNull NewsPostViewHolder holder, int position, @NonNull List<Object> payloads) {\r\n        if (payloads.isEmpty()) {\r\n            super.onBindViewHolder(holder, position, payloads);\r\n        } else {\r\n            if (payloads.contains(\"like_status_changed\")) {\r\n                NewsPost currentPost = postList.get(position);\r\n                holder.updateLikeStatus(currentPost);\r\n            }\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public int getItemCount() {\r\n        return postList != null ? postList.size() : 0;\r\n    }\r\n\r\n    public static class NewsPostViewHolder extends RecyclerView.ViewHolder {\r\n        public ImageView avatar;\r\n        public TextView author;\r\n        public TextView time;\r\n        public TextView content;\r\n        public ImageView postImage;\r\n        public TextView commentCount;\r\n        public TextView likeCount;\r\n        public ImageView btnLike;\r\n        public ImageView btnMoreOptions;\r\n        public LinearLayout commentArea;\r\n\r\n        public NewsPostViewHolder(@NonNull View itemView, final OnItemClickListener listener) {\r\n            super(itemView);\r\n\r\n            avatar = itemView.findViewById(R.id.imgAvatar);\r\n            author = itemView.findViewById(R.id.tvUsername);\r\n            time = itemView.findViewById(R.id.tvTime);\r\n            content = itemView.findViewById(R.id.tvContent);\r\n            postImage = itemView.findViewById(R.id.imgMain);\r\n            commentCount = itemView.findViewById(R.id.tvCommentCount);\r\n            likeCount = itemView.findViewById(R.id.tvLikeCount); // ID của TextView số lượt thích\r\n            btnLike = itemView.findViewById(R.id.btnLike);\r\n            commentArea = itemView.findViewById(R.id.bangtin_layout_comment_area);\r\n            btnMoreOptions = itemView.findViewById(R.id.btnMoreOptions);\r\n\r\n            commentArea.setOnClickListener(v -> {\r\n                if (listener != null) {\r\n                    int position = getAdapterPosition();\r\n                    if (position != RecyclerView.NO_POSITION) {\r\n                        listener.onCommentClick(position);\r\n                    }\r\n                }\r\n            });\r\n\r\n            btnLike.setOnClickListener(v -> {\r\n                if (listener != null) {\r\n                    int position = getAdapterPosition();\r\n                    if (position != RecyclerView.NO_POSITION) {\r\n                        listener.onLikeClick(position);\r\n                    }\r\n                }\r\n            });\r\n\r\n            btnMoreOptions.setOnClickListener(v -> {\r\n                if (listener != null) {\r\n                    int position = getAdapterPosition();\r\n                    if (position != RecyclerView.NO_POSITION) {\r\n                        listener.onMoreOptionsClick(position, v);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // Gán dữ liệu vào ViewHolder (ĐÃ SỬA ĐỂ DÙNG GLIDE)\r\n        public void bind(NewsPost post) {\r\n            author.setText(post.author);\r\n            time.setText(post.time);\r\n            content.setText(post.content);\r\n            avatar.setImageResource(post.avatarResource);\r\n\r\n            // SỬ DỤNG GLIDE ĐỂ TẢI ẢNH TỪ URL\r\n            if (post.imageUrl != null && !post.imageUrl.isEmpty()) {\r\n                postImage.setVisibility(View.VISIBLE);\r\n                Glide.with(itemView.getContext())\r\n                     .load(post.imageUrl)\r\n                     .placeholder(R.drawable.placeholder_image) // Ảnh hiển thị trong lúc tải\r\n                     .error(R.drawable.bangtin_img_default_post) // Ảnh hiển thị khi lỗi\r\n                     .into(postImage);\r\n            } else {\r\n                postImage.setVisibility(View.GONE);\r\n            }\r\n            updateLikeStatus(post);\r\n            commentCount.setText(String.valueOf(post.commentCount) + \" Bình luận\");\r\n        }\r\n\r\n        // Cập nhật trạng thái và số lượt thích\r\n        public void updateLikeStatus(NewsPost post) {\r\n            likeCount.setText(String.valueOf(post.likeCount) + \" lượt thích\");\r\n            if (post.isLiked) {\r\n                btnLike.setImageResource(R.drawable.bangtin_heart_filled); // Icon trái tim đã tô màu\r\n            } else {\r\n                btnLike.setImageResource(R.drawable.bangtin_heart_outline); // Icon trái tim rỗng\r\n            }\r\n        }\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/thiennguyen/api/bangtin/NewsPostAdapter.java b/app/src/main/java/com/example/thiennguyen/api/bangtin/NewsPostAdapter.java
--- a/app/src/main/java/com/example/thiennguyen/api/bangtin/NewsPostAdapter.java	(revision 33d3b47e928e075d4e536a8d4cd53365d1637416)
+++ b/app/src/main/java/com/example/thiennguyen/api/bangtin/NewsPostAdapter.java	(date 1764924558985)
@@ -141,7 +141,6 @@
             updateLikeStatus(post);
             commentCount.setText(String.valueOf(post.commentCount) + " Bình luận");
         }
-
         // Cập nhật trạng thái và số lượt thích
         public void updateLikeStatus(NewsPost post) {
             likeCount.setText(String.valueOf(post.likeCount) + " lượt thích");
Index: app/src/main/java/com/example/thiennguyen/api/bangtin/RetrofitClient.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.thiennguyen.api.bangtin;\r\n\r\nimport com.google.gson.Gson;\r\nimport com.google.gson.GsonBuilder;\r\n\r\nimport retrofit2.Retrofit;\r\nimport retrofit2.converter.gson.GsonConverterFactory;\r\n\r\npublic class RetrofitClient {\r\n\r\n    private static final String BASE_URL = \"http://192.168.1.81:5089/\";\r\n\r\n    private static Retrofit retrofit;\r\n\r\n    public static ApiService getService() {\r\n        if (retrofit == null) {\r\n            // Cấu hình Gson để hiểu định dạng ngày tháng từ API\r\n            Gson gson = new GsonBuilder()\r\n                    .setDateFormat(\"yyyy-MM-dd'T'HH:mm:ss\")\r\n                    .create();\r\n\r\n            retrofit = new Retrofit.Builder()\r\n                    .baseUrl(BASE_URL)\r\n                    // Sử dụng Gson đã được cấu hình\r\n                    .addConverterFactory(GsonConverterFactory.create(gson))\r\n                    .build();\r\n        }\r\n        return retrofit.create(ApiService.class);\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/example/thiennguyen/api/bangtin/RetrofitClient.java b/app/src/main/java/com/example/thiennguyen/api/bangtin/RetrofitClient.java
--- a/app/src/main/java/com/example/thiennguyen/api/bangtin/RetrofitClient.java	(revision 33d3b47e928e075d4e536a8d4cd53365d1637416)
+++ b/app/src/main/java/com/example/thiennguyen/api/bangtin/RetrofitClient.java	(date 1764922847195)
@@ -8,7 +8,7 @@
 
 public class RetrofitClient {
 
-    private static final String BASE_URL = "http://192.168.1.81:5089/";
+    private static final String BASE_URL = "http://192.168.114.213:5089/";
 
     private static Retrofit retrofit;
 
